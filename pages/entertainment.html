<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activities - Girton Feast</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="../images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicons/favicon-16x16.png">
    <link rel="manifest" href="../images/favicons/site.webmanifest">
    <link rel="shortcut icon" href="../images/favicons/favicon.ico">

    <!-- Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts: Sigmar One and Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sigmar+One&family=Poppins:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <!-- Favicon Placeholder -->
</head>

<body class="bg-brand-glaucous" x-data x-on:keydown.window="$store.app.handleKonami($event.key)">

    <!-- Placeholder for the navigation bar -->
    <div id="navbar-placeholder"></div>

    <main class="container-xxl my-5"
          x-data="{
            items: [],
            selectedDay: 'all',
            selectedTag: 'all',
            async init() {
                const response = await fetch('../entertainment.json');
                this.items = await response.json();

                // Handle initial filters from URL
                const params = new URLSearchParams(window.location.search);
                if (params.has('tag')) this.selectedTag = params.get('tag');
                if (params.has('day')) this.selectedDay = params.get('day');
            },
            get filteredItems() {
                return this.items.filter(item => {
                    const dayMatch = this.selectedDay === 'all' ||
                                   item.days.includes(this.selectedDay) ||
                                   item.days.includes('Both');
                    const tagMatch = this.selectedTag === 'all' ||
                                   item.tags.includes(this.selectedTag);
                    return dayMatch && tagMatch;
                });
            },
            get uniqueTags() {
                const tags = new Set();
                this.items.forEach(item => item.tags.forEach(tag => tags.add(tag)));
                return Array.from(tags).sort();
            }
          }">

        <div class="row pt-2">
            <!-- Sidebar for Desktop Filters -->
            <aside class="col-lg-3 col-xl-3 col-xxl-3 d-none d-lg-block">
                <div class="text-center">
                    <img src="../images/goose_golf.svg" alt="A badly drawn goose attempting to play mini golf" class="img-fluid mt-5">
                </div>
                <div class="p-4 rounded-4 shadow-sm sticky-top bg-light" style="top: 100px;">
                    <div class="mb-5">
                        <div class="segmented-control d-flex gap-1 p-1 bg-dark bg-opacity-10 rounded-pill">
                            <input type="radio" class="btn-check" name="day-filter" id="day-all" value="all" x-model="selectedDay">
                            <label class="btn btn-sm btn-outline-primary border-0 rounded-pill flex-fill py-2 fw-bold" for="day-all">Both</label>

                            <input type="radio" class="btn-check" name="day-filter" id="day-fri" value="Friday" x-model="selectedDay">
                            <label class="btn btn-sm btn-outline-primary border-0 rounded-pill flex-fill py-2 fw-bold" for="day-fri">Fri</label>

                            <input type="radio" class="btn-check" name="day-filter" id="day-sat" value="Saturday" x-model="selectedDay">
                            <label class="btn btn-sm btn-outline-primary border-0 rounded-pill flex-fill py-2 fw-bold" for="day-sat">Sat</label>
                        </div>
                    </div>
                    <div id="entertainment-filters-sidebar" class="d-flex flex-column gap-2">
                        <!-- All Categories Toggle -->
                        <div class="filter-item d-flex align-items-center justify-content-between p-3 rounded-4 transition-300"
                             :class="selectedTag === 'all' ? 'bg-brand-marian-blue text-white shadow' : 'bg-white hover-light'"
                             @click="selectedTag = 'all'">
                            <div class="d-flex align-items-center">
                                <div class="filter-checkbox-custom me-3 rounded-circle border border-2 d-flex align-items-center justify-content-center"
                                     :class="selectedTag === 'all' ? 'border-white bg-white-opacity-20' : 'border-secondary'">
                                    <i class="fas fa-check small" x-show="selectedTag === 'all'"></i>
                                </div>
                                <span class="filter-label fw-bold">All Activities</span>
                            </div>
                            <span class="badge rounded-pill bg-white text-dark small" x-text="items.length"></span>
                        </div>

                        <!-- Dynamic Tag Filters -->
                        <template x-for="tag in uniqueTags">
                            <div class="filter-item d-flex align-items-center justify-content-between p-3 rounded-4 transition-300 text-capitalize"
                                 :class="selectedTag === tag ? 'bg-brand-marian-blue text-white shadow' : 'bg-white hover-light'"
                                 @click="selectedTag = tag">
                                <div class="d-flex align-items-center">
                                    <div class="filter-checkbox-custom me-3 rounded-circle border border-2 d-flex align-items-center justify-content-center"
                                         :class="selectedTag === tag ? 'border-white bg-white-opacity-20' : 'border-secondary'">
                                        <i class="fas fa-check small" x-show="selectedTag === tag"></i>
                                    </div>
                                    <span class="filter-label fw-bold" x-text="tag.replace(/-/g, ' ')"></span>
                                </div>
                                <span class="badge rounded-pill bg-white text-dark small"
                                      x-text="items.filter(i => i.tags.includes(tag)).length"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <div class="col-lg-9 col-xl-9 col-xxl-9">
                <!-- Header -->
                <div class="text-center pt-5 mb-5">
                    <img src="../images/titles/whats-on-text.svg" alt="What's On Header" class="img-fluid"
                        style="max-width: min(500px, 90vw);">
                </div>
                <div id="entertainment-container" class="row g-4">
                    <template x-for="item in filteredItems" :key="item.name">
                        <div class="col-md-6 col-lg-4 col-xl-4 col-xxl-3 card-wrapper" x-show="true" x-transition>
                            <a :href="item.url" target="_blank" class="card border-0 shadow-sm h-100 overflow-hidden text-decoration-none hover-scale">
                                <div class="ratio ratio-4x3 p-5">
                                    <img :src="'../' + item.image" class="card-img object-fit-cover" :alt="item.name">
                                </div>
                                <div class="card-img-overlay d-flex flex-column justify-content-end"
                                    style="background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.8) 100%);">
                                    <h4 class="card-title fw-bold text-white mb-1" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);" x-text="item.name"></h4>
                                    <div class="text-white-50 small mb-2" x-text="item.description.replace(/<[^>]*>?/gm, '').substring(0, 100) + '...'"></div>
                                    <div class="d-flex flex-wrap gap-1">
                                        <template x-for="tag in item.tags">
                                            <span class="badge rounded-pill shadow-sm"
                                                  :class="'bg-brand-' + tag"
                                                  style="font-size: 0.65rem;"
                                                  x-text="tag.replace(/-/g, ' ')"></span>
                                        </template>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </template>
                </div>
            </div>
        </div>


        <!-- Floating Action Button for Mobile Filters -->
        <button class="fab-filter d-lg-none" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasFilters" aria-controls="offcanvasFilters">
            <i class="fas fa-filter"></i>
        </button>

        <!-- Offcanvas Moblie Filters -->
        <div class="offcanvas offcanvas-bottom rounded-top-4" tabindex="-1" id="offcanvasFilters"
        aria-labelledby="offcanvasFiltersLabel" style="height: auto; max-height: 85vh;">
            <div class="offcanvas-header border-bottom py-3">
                <h5 class="offcanvas-title fw-bold" id="offcanvasFiltersLabel" style="color: var(--brand-marian-blue);">
                    <i class="fas fa-sliders-h me-2"></i>Filter Activities
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body p-4">
                <div class="mb-4">
                    <h6 class="fw-bold mb-3 text-muted small text-uppercase letter-spacing-1">Day</h6>
                    <div class="btn-group w-100 segmented-control" role="group" aria-label="Day Filter Mobile">
                        <input type="radio" class="btn-check" name="day-filter-mobile" id="day-all-mobile" value="all" x-model="selectedDay">
                        <label class="btn btn-outline-primary py-2" for="day-all-mobile">Both</label>

                        <input type="radio" class="btn-check" name="day-filter-mobile" id="day-fri-mobile" value="Friday" x-model="selectedDay">
                        <label class="btn btn-outline-primary py-2" for="day-fri-mobile">Fri</label>

                        <input type="radio" class="btn-check" name="day-filter-mobile" id="day-sat-mobile" value="Saturday" x-model="selectedDay">
                        <label class="btn btn-outline-primary py-2" for="day-sat-mobile">Sat</label>
                    </div>
                </div>

                <div>
                    <h6 class="fw-bold mb-3 text-muted small text-uppercase letter-spacing-1">Categories</h6>
                    <div class="mobile-filter-grid overflow-auto pb-2" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <!-- All Categories Toggle -->
                        <div class="filter-item text-center p-2 rounded-3 border transition-200"
                             :class="selectedTag === 'all' ? 'bg-brand-marian-blue text-white border-brand-marian-blue shadow-sm' : 'bg-light border-light-subtle'"
                             @click="selectedTag = 'all'">
                            <span class="small fw-bold">All</span>
                        </div>
                        <!-- Dynamic Tag Filters -->
                        <template x-for="tag in uniqueTags">
                            <div class="filter-item text-center p-2 rounded-3 border transition-200 text-capitalize"
                                 :class="selectedTag === tag ? 'bg-brand-marian-blue text-white border-brand-marian-blue shadow-sm' : 'bg-light border-light-subtle'"
                                 @click="selectedTag = tag">
                                <span class="small fw-bold" x-text="tag.replace(/-/g, ' ')"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="mt-4 pt-2">
                    <button type="button" class="btn btn-brand-marian-blue w-100 rounded-pill py-3 fw-bold shadow-sm" data-bs-dismiss="offcanvas">
                        Show Results
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div class="d-lg-none text-end">
        <img src="../images/goose_golf.svg"
            alt="A badly drawn goose attempting to play mini golf"
            class="img-fluid mt-5">
    </div>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Mobile Nav Placeholder -->
    <div id="mobile-nav-placeholder"></div>


    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/script.js"></script>
    <script>
        loadComponent("#navbar-placeholder", "../components/navbar.html");
        loadComponent("#footer-placeholder", "../components/footer.html")
            .then(() => setCopyrightYear());
    </script>
</body>

</html>
